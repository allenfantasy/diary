<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>July 22, 2015</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/css/global.css"><link rel="stylesheet" href="/diary/css/tomorrow.css"><link rel="stylesheet" href="/diary/css/diary.css"></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>July 22, 2015</h1></header><div class="content"><div class="diary"><h2 id="js">JS</h2>
<h3 id="pop-up-confirmation-before-leaving-the-page-">Pop up confirmation before leaving the page.</h3>
<p>There are two circumstances:</p>
<ol>
<li>the user click browser&#39;s button (back, forward, refresh, F5, ...)</li>
<li>the user click any element on the page which may lead to a page leaving.</li>
</ol>
<h4 id="case-1-clicking-browser-s-button">CASE 1: clicking browser&#39;s button</h4>
<p>One can should know <code>beforeunload</code> and <code>unload</code> event.</p>
<ul>
<li><code>beforeunload</code> is fired when the window, the document and its resources are <strong>about to be</strong> unloaded</li>
<li><code>unload</code> is fired when the document or a child resource is <strong>being</strong> unloaded. It&#39;s fired <strong>after</strong> <code>beforeunload</code>.</li>
</ul>
<p>In handlers for these 2 events, <code>confirm()</code>, <code>open()</code>, <code>alert()</code> has no effect.</p>
<p>In <code>unload</code> you can cleanup some shitty things like GC does, but you cannot revert the whole progress (say, leaving the page), while in <code>beforeunload</code>, you can:</p>
<pre><code class="lang-js"><span class="hljs-built_in">window</span>.onbeforeunload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">"Some warnings / tips to user"</span>; <span class="hljs-comment">// This string would be displayed on confirm box.</span>
}
</code></pre>
<p>If using event listeners, the safest code is:</p>
<pre><code class="lang-js"><span class="hljs-comment">// IE 9+, Chrome, Firefox, Opera</span>
<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'beforeunload'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
  <span class="hljs-keyword">var</span> msg = <span class="hljs-string">"Some warnings / tips to user"</span>;
  (e || <span class="hljs-built_in">window</span>.event).returnValue = msg;
  <span class="hljs-keyword">return</span> msg;
});
<span class="hljs-comment">// You may add `addEvent` if &lt;= IE 8 support is needed</span>
</code></pre>
<p>However, 2 drawbacks MUST be noted:</p>
<ol>
<li>You <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload#Notes">cannot control the message in <strong>Firefox</strong></a>.</li>
<li>The confirm box is provided by browser thus the <strong>UI is set</strong>.</li>
</ol>
<h4 id="case-2-click-any-elements">CASE 2 - click any elements</h4>
<p>Just attach events to all needed elements in the page, popup the custom confirm box on <code>click</code> event.</p>
<pre><code class="lang-js"><span class="hljs-comment">// jQuery version</span>
$(<span class="hljs-string">'a[href=*]'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
  popupConfirmBox();
});
</code></pre>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="http://stackoverflow.com/a/6348597/1301194">Event Listeners vs. inline events</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload"><code>onbeforeunload</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Events/unload"><code>unload</code></a></li>
</ul>
</div></div><footer class="footer"><address class="author">Copyright &copy; <a rel="author" href="https://github.com/allenfantasy" class="author-name">Allen Wu</a>-<a href="https://github.com/allenfantasy/my-tech-diary" class="source-repo">Source</a></address><p>Generated by <a href="https://github.com/joyeecheung/diary" class="site-repo">Joyee Cheung&#39;s diary generator</a></p></footer></body></html>